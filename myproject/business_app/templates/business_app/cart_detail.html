{% extends "base.html" %}

{% load static %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- Sidebar for navigation -->
        <div class="col-md-3">
            <div class="sidebar">
                 <form method="post" action="{% url 'create_order' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Оформить заказ</button>
                </form>
                <button class="btn btn-secondary" onclick="window.location.href='{% url 'clear_cart' %}'">Сбросить всё</button>
                <button class="btn btn-info" onclick="window.location.href='{% url 'main_page' %}'">Добавить товар</button>
            </div>
        </div>

        <!-- Main content area for cart details -->
        <div class="col-md-9">
            <h2>Корзина</h2>

            <!-- Cart items -->
            <div class="cart-items">
                {% for item in cart %}
                    <div class="cart-item">
                        <!-- Ссылка на карточку товара -->
                        <a href="{% url 'product_detail' item.product.id %}">{{ item.product.name }}</a>

                        <!-- Описание товара -->
                        <p>{{ item.product.description }}</p>

                        <!-- Превью изображения -->
                        {% if item.product.image %}
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="max-width: 100px;">
                        {% endif %}

                        <!-- Количество товара -->
                        <span>Количество: {{ item.quantity }}</span>

                        <!-- Цена за штуку -->
                        <span>Цена за штуку: {{ item.price|floatformat:2 }}</span>

                        <!-- Итоговая цена за количество -->
                        <span>Итого: {{ item.line_total|floatformat:2 }}</span>

                        <!-- Кнопки управления -->
                        <button class="btn btn-sm btn-success" onclick="window.location.href='{% url 'add_to_cart' item.product.id %}'">Добавить</button>
                        <button class="btn btn-sm btn-danger" onclick="window.location.href='{% url 'remove_from_cart' item.product.id %}'">Убрать</button>
                    </div>
                {% empty %}
                    <p>Корзина пуста.</p>
                {% endfor %}
            </div>
            <!-- Общая сумма -->
            <div class="cart-total">
                <strong>Общая сумма: {{ total_amount|floatformat:2 }}</strong>
            </div>

            <!-- Cart form for additional details -->
            <form method="post">
                {% csrf_token %}
                {{ cart_form.as_p }}
                <button type="submit" class="btn btn-primary">Обновить заказ</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}